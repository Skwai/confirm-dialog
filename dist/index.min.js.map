{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["const DEFAULTS = {\n  cancelLabel: 'Cancel',\n  canCancel: true,\n  className: 'ConfirmDialog',\n  confirmLabel: 'Confirm',\n  message: null,\n  onCancel: () => {},\n  onConfirm: () => {},\n  parent: document.body,\n  title: 'Please Confirm',\n};\n\nconst ESCAPE_KEYCODE = 27;\n\nexport default class ConfirmDialog {\n  constructor(args) {\n    this.opts = Object.assign({}, DEFAULTS, args);\n\n    if (!(this.opts.parent instanceof Node)) {\n      throw Error('`parent` is not a valid `HTMLElement`');\n    }\n\n    Object.assign(this, {\n      destroyed: false,\n      loading: false,\n      cancelled: false,\n      confirmed: false,\n      handleConfirm: this.handleConfirm.bind(this),\n      handleCancel: this.handleCancel.bind(this),\n      handleEscape: this.handleEscape.bind(this),\n    });\n\n    this.render();\n  }\n\n  render() {\n    if (this.element) throw Error('Cannot render, `this.element` already exists');\n\n    this.element = document.createElement('div');\n    this.element.classList.add(this.opts.className);\n    this.element.innerHTML = this.template(this.opts);\n    this.confirmButton = this.getConfirmButton();\n    this.cancelButton = this.getCancelButton();\n    this.opts.parent.appendChild(this.element);\n    this.bindListeners();\n  }\n\n  destroy() {\n    if (this.destroyed) return false;\n\n    this.unbindListeners();\n\n    if (this.element instanceof Node) {\n      this.element.parentNode.removeChild(this.element);\n      delete this.element;\n      this.destroyed = true;\n    }\n\n    return this.destroyed;\n  }\n\n  handleEscape(ev) {\n    if (ev.keyCode === ESCAPE_KEYCODE) this.handleCancel(ev);\n  }\n\n  getConfirmButton() {\n    this.confirmButton = this.confirmButton || this.element.querySelector(`.${this.opts.className}__Confirm`);\n    return this.confirmButton;\n  }\n\n  getCancelButton() {\n    this.cancelButton = this.cancelButton || this.element.querySelector(`.${this.opts.className}__Cancel`);\n    return this.cancelButton;\n  }\n\n  bindListeners() {\n    const { element: el, cancelButton, confirmButton } = this;\n    this.getConfirmButton().addEventListener('click', this.handleConfirm);\n    if (this.opts.canCancel) {\n      el.addEventListener('click', (ev) => ev.target.isSameNode(el) ? this.handleCancel() : ev);\n      window.addEventListener('keyup', this.handleEscape);\n      this.getCancelButton().addEventListener('click', this.handleCancel);\n    }\n  }\n\n  unbindListeners() {\n    window.removeEventListener('keyup', this.handleEscape);\n  }\n\n  confirm() {\n    return this.handleConfirm();\n  }\n\n  cancel() {\n    return this.handleCancel();\n  }\n\n  async handleCancel(ev) {\n    if (!this.opts.canCancel || this.loading) return Promise.reject();\n\n    let result;\n    this.loading = true;\n    try {\n      result = await this.opts.onCancel(ev);\n      this.cancelled = true;\n      this.destroy();\n    } catch (err) {\n      result = Promise.reject(err);\n    }\n    this.loading = false;\n    return result;\n  }\n\n  async handleConfirm(ev) {\n    if (this.loading) return Promise.reject();\n\n    let result;\n    this.loading = true;\n    try {\n      result = await this.opts.onConfirm(ev);\n      this.confirmed = true;\n      this.destroy();\n    } catch (err) {\n      result = Promise.reject(err);\n    }\n    this.loading = false;\n    return result;\n  }\n\n  template({\n    canCancel,\n    cancelLabel,\n    className: cn,\n    confirmLabel,\n    message,\n    title,\n  }) {\n    return `\n      <div\n        class=\"${cn}__Content\"\n        role=\"alertdialog\"\n        aria-hidden=\"false\"\n        aria-labelledby=\"\"\n        aria-describedby=\"\"\n      >\n        <header class=\"${cn}__Header\">\n          <h4 class=\"${cn}__Title\">${title}</h4>\n        </header>\n        ${message ? `<div class=\"${cn}__Message\">${message}</div>` : ''}\n        <footer class=\"${cn}__Actions\">\n          ${confirmLabel ? `<button type=\"button\" class=\"${cn}__Confirm\">${confirmLabel}</button>` : ''}\n          ${canCancel ? `<button type=\"button\" class=\"${cn}__Cancel\">${cancelLabel}</button>` : ''}\n        </footer>\n      </div>\n    `;\n  }\n}\n"],"names":["DEFAULTS","document","body","args","opts","Object","assign","this","parent","Node","Error","handleConfirm","bind","handleCancel","handleEscape","render","element","createElement","classList","add","className","innerHTML","template","confirmButton","getConfirmButton","cancelButton","getCancelButton","appendChild","bindListeners","destroyed","unbindListeners","parentNode","removeChild","ev","keyCode","querySelector","el","addEventListener","canCancel","target","isSameNode","_this","removeEventListener","_this2","loading","Promise","reject","onCancel","cancelled","destroy","err","result","_this5","onConfirm","confirmed","cancelLabel","cn","confirmLabel","message","title"],"mappings":";;;;;;ihBAAMA,eACS,oBACF,YACA,6BACG,kBACL,cACC,uBACC,oBACHC,SAASC,WACV,+CAMKC,qBACLC,KAAOC,OAAOC,UAAWN,EAAUG,KAElCI,KAAKH,KAAKI,iBAAkBC,YAC1BC,OAAM,gDAGPJ,OAAOC,iBACD,WACF,aACE,aACA,gBACIA,KAAKI,cAAcC,KAAKL,mBACzBA,KAAKM,aAAaD,KAAKL,mBACvBA,KAAKO,aAAaF,KAAKL,aAGlCQ,uDAIDR,KAAKS,QAAS,KAAMN,OAAM,qDAEzBM,QAAUf,SAASgB,cAAc,YACjCD,QAAQE,UAAUC,IAAIZ,KAAKH,KAAKgB,gBAChCJ,QAAQK,UAAYd,KAAKe,SAASf,KAAKH,WACvCmB,cAAgBhB,KAAKiB,wBACrBC,aAAelB,KAAKmB,uBACpBtB,KAAKI,OAAOmB,YAAYpB,KAAKS,cAC7BY,yDAIDrB,KAAKsB,iBAEJC,kBAEDvB,KAAKS,kBAAmBP,aACrBO,QAAQe,WAAWC,YAAYzB,KAAKS,eAClCT,MAAKS,aACPa,WAAY,GAGZtB,KAAKsB,gDAGDI,GAjDQ,KAkDfA,EAAGC,SAA4B3B,KAAKM,aAAaoB,0DAIhDV,cAAgBhB,KAAKgB,eAAiBhB,KAAKS,QAAQmB,kBAAkB5B,KAAKH,KAAKgB,uBAC7Eb,KAAKgB,oEAIPE,aAAelB,KAAKkB,cAAgBlB,KAAKS,QAAQmB,kBAAkB5B,KAAKH,KAAKgB,sBAC3Eb,KAAKkB,gEAIKW,EAAoC7B,KAA7CS,OAA6CT,MAAhCkB,aAAgClB,KAAlBgB,mBAC9BC,mBAAmBa,iBAAiB,QAAS9B,KAAKI,eACnDJ,KAAKH,KAAKkC,cACTD,iBAAiB,QAAS,SAACJ,SAAOA,GAAGM,OAAOC,WAAWJ,GAAMK,EAAK5B,eAAiBoB,WAC/EI,iBAAiB,QAAS9B,KAAKO,mBACjCY,kBAAkBW,iBAAiB,QAAS9B,KAAKM,gEAKjD6B,oBAAoB,QAASnC,KAAKO,sDAIlCP,MAAKI,uDAILJ,MAAKM,oDAGKoB,gEACZU,EAAKvC,KAAKkC,WAAaK,EAAKC,QAAgBC,QAAQC,6DAGpDF,SAAU,0CAEED,GAAKvC,KAAK2C,SAASd,4BAC7Be,WAAY,IACZC,2BACEC,KACEL,QAAQC,OAAOI,gCAErBN,SAAU,EACRO,+DAGWlB,+DACdmB,GAAKR,QAAgBC,QAAQC,6DAG5BF,SAAU,0CAEEQ,GAAKhD,KAAKiD,UAAUpB,4BAC9BqB,WAAY,IACZL,2BACEC,KACEL,QAAQC,OAAOI,gCAErBN,SAAU,EACRO,gEAIPb,KAAAA,UACAiB,IAAAA,YACWC,IAAXpC,UACAqC,IAAAA,aACAC,IAAAA,8CAKaF,mKAMQA,sCACFA,gBAXnBG,4CAaMD,iBAAyBF,gBAAgBE,WAAkB,gCAC5CF,6BACbC,kCAA+CD,gBAAgBC,cAA0B,oBACzFnB,kCAA4CkB,eAAeD,cAAyB"}